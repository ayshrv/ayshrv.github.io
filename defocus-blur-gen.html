<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="Fine-grained Defocus Blur Control for Generative Image Models">
  <meta name="keywords" content="Duffusion Models, Defocus Blur, Generative Image Models">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fine-grained Defocus Blur Control for Generative Image Models</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-131271936-1', 'auto');
    ga('send', 'pageview');

  </script>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="/static/nerfies/css/bulma.min.css">
  <!-- <link rel="stylesheet" href="/static/nerfies/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="/static/nerfies/css/bulma-slider.min.css"> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="/static/nerfies/css/index.css">
  <link rel="icon" href="/static/cmrw/img/icon.png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  
  <!-- <script src="/static/nerfies/js/bulma-carousel.min.js"></script> -->
  <!-- <script src="/static/nerfies/js/bulma-slider.min.js"></script> -->
  <script src="/static/nerfies/js/index.js"></script>
  
  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true
      },
      options: {
        skipHtmlTags: ['script','noscript','style','textarea','pre','code']
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>

<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Fine-grained Defocus Blur Control for Generative Image Models</h1>
          <div class="is-size-5 publication-authors">
            <!-- # Connelly Barnes, Xuaner Zhang, Lingzhi Zhang, Andrew Owens, Sohrab Amirghodsi, Eli Shechtman -->
            <span class="author-block">
              <a href="https://ayshrv.com">Ayush Shrivastava<sup>1</sup></a>,</span>
              <span class="author-block">
                <a href="https://www.connellybarnes.com/">Connelly Barnes<sup>2</sup></a>,</span>
            <span class="author-block">
              <a href="https://ceciliavision.github.io/">Xuaner Zhang<sup>2</sup></a>,</span>
            <span class="author-block">
              <a href="https://owenzlz.github.io/">Lingzhi Zhang<sup>2</sup></a>,</span>
            <span class="author-block">
              <a href="https://andrewowens.com/">Andrew Owens<sup>1</sup></a>,</span>
            <span class="author-block">
              <a href="https://www.linkedin.com/in/sohrab-amirghodsi-a89548a3/">Sohrab Amirghodsi<sup>2</sup></a>,</span>
            <span class="author-block">
              <a href="https://research.adobe.com/person/eli-shechtman/">Eli Shechtman<sup>2</sup></a></span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>1</sup>University of Michigan,</span>
            <span class="author-block"><sup>2</sup>Adobe Research</span>
          </div>
          <!-- <div class="is-size-5 publication-authors">
            <span class="author-block">CVPR 2025</span>
          </div> -->

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href=""
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper (Coming Soon)</span>
                </a>
              </span>
              <!-- <span class="link-block">
                <a href=""
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span> -->
              <!-- Video Link. -->
              <!-- <span class="link-block">
                <a href="https://www.youtube.com/watch?v=MrKrnHhk8IA"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Video</span>
                </a>
              </span> -->
              <!-- Code Link. -->
              <!-- <span class="link-block">
                <a href="https://github.com/ayshrv/cmrw"
                   target="_blank"
                   rel="noopener"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span> -->
              <span class="link-block">
                <a href="#bibtex"
                   class="external-link button is-normal is-rounded is-dark">
                  <!-- <span class="icon">
                      <i class="fas fa-quote-right"></i>
                  </span> -->
                  <span class="icon">
                    <svg class="svg-inline--fa fa-book fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z" data-darkreader-inline-fill="" style="--darkreader-inline-fill: currentColor;"></path></svg><!-- <i class="fas fa-book"></i> Font Awesome fontawesome.com -->
                  </span>
                  <span>BibTeX</span>
                </a>
              </span>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<section class="hero teaser">
  <div class="container is-max-desktop is-gapless">
    <div class="column is-gapless">
      <h1 class="subtitle is-5 has-text-centered">
        <b>TL;DR:</b> We propose a text-to-image model that precisely controls the amount and location of defocus blur in generated images while preserving the scene content.
      </h1>
    </div>
    <br>
    <div class="hero-body">
      <div class="teaser-grid-2x2">
        <img class="thumb" src="/static/defocus-blur-gen/imgs/teaser1.png" width="100%" alt="teaser image">
        <div class="column has-text-centered">
          <b>(a) Text-to-Image Methods:</b> Prior methods like Camera-Settings-as-Tokens<sup id="csat-footnote-ref"><a href="#csat">1</a></sup>, fail to maintain scene content when adjusting aperture.
        </div>
        <img class="thumb" src="/static/defocus-blur-gen/imgs/teaser2.png" width="100%" alt="teaser image">
        <div class="column has-text-centered">
          <b>(b) Ours (Text-to-Image + Lens Model): </b> Our model produces images with controllable defocus blur while preserving the scene. Each image reflects the specified aperture and focus distance: lower focus distances sharpen the foreground, while higher ones shift focus to the background. The orange bar <span style="color: #c04f14;"><b>[</b></span> marks the in-focus region. Higher f-stops result in reduced blur, producing an all-in-focus image at f/22. 
        </div>
        <!-- <img class="thumb" src="/static/cmrw/img/teaser3.png" width="77%" alt="CMRW teaser image">
        <img class="thumb" src="/static/cmrw/img/teaser2.png" width="100%" alt="CMRW teaser image">
        <img class="thumb" src="/static/cmrw/img/teaser4.png" width="77%" alt="CMRW teaser image"> -->
      </div>
    <!-- <div class="column is-gapless"> -->
      <!-- <h1 class="subtitle is-6 has-text-centered"> -->
        <!-- <b>(a)</b> Prior methods like Camera-Settings-as-Tokens<sup id="csat-footnote-ref"><a href="#csat">1</a></sup>, fail to maintain scene content when adjusting aperture. -->
        <!-- <b>(b)</b> Our model produces images with controllable defocus blur while preserving the scene. Each image reflects the specified aperture and focus distance: lower focus distances sharpen the foreground, while higher ones shift focus to the background. The orange bar <span style="color: #c04f14;"><b>[</b></span> marks the in-focus region. Higher f-stops result in reduced blur, producing an all-in-focus image at f/22. -->
      <!-- </h1> -->
    <!-- </div> -->
  </div>
</section>


<section class="section">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Current text-to-image diffusion models excel at generating diverse, high-quality images, yet they struggle to incorporate fine-grained camera metadata such as precise aperture settings. In this work, we introduce a novel text-to-image diffusion framework that leverages camera metadata, or EXIF data, which is often embedded in image files, with an emphasis on generating controllable lens blur. Our method mimics the physical image formation process by first generating an all-in-focus image, estimating its monocular depth, predicting a plausible focus distance with a novel focus distance transformer, and then forming a defocused image with an existing differentiable lens blur model<sup id="taf-footnote-ref"><a href="#taf">2</a></sup>. Gradients flow backwards through this whole process, allowing us to learn without explicit supervision to generate defocus effects based on content elements and the provided EXIF data. At inference time, this enables precise interactive user control over defocus effects while preserving scene contents, which is not achievable with existing diffusion models. Experimental results demonstrate that our model enables superior fine-grained control without altering the depicted scene.
        </p>
        </div>
      </div>
    </div>
    <!--/ Abstract. -->

</section>

<section class="section">
  <div class="container is-max-desktop">

    <div class="columns is-centered">
      <div class="content">
        <h2 class="title is-3">Method</h2>
        <!-- Any description here -->
      </div>

    </div>
        <div class="content">
          <div class="image is-centered mt-6">
            <img id="method-arch" class="is-centered" src="/static/defocus-blur-gen/imgs/architecture.png" alt="method diagram" style="width: 100% !important; height: auto !important; display: block; margin: 1% auto;">
            </div>
          <p>
            <!-- We propose an image generation method that enables precise control over blur intensity and location within an image.  -->
            Our model obtains its supervision from a differentiable lens model and training examples of images with shallow and deep depth-of-field. We train our model to generate an all-in-focus image using $G_{\theta}$. A depth model then predicts depth for this image, which, along with the image itself, is fed into a model that estimates the focus distance $f_d$ and depth scale $f_s$. Finally, a lens model combines EXIF data with these predictions to apply spatially varying blur, generating the final image. We train the all-in-focus generator using unsupervised DMD2<sup id="dmd2-footnote-ref"><a href="#dmd2">3</a></sup> losses on our unpaired Deep DoF dataset and optimize the entire pipeline with DMD2 losses on the unpaired Shallow DoF dataset.
          </p>
          
        </div>
    </div>
    
  </div>
</section>


<section class="section">
  <div class="container is-max-desktop">
    <div class="columns is-centered">
      <div class="content">
        <h2 class="title is-3">Results</h2>
        <p class="mb-6"></p>
      </div>
    </div>
    <div class="columns is-centered">
      <div class="content">
        <h2 class="title is-4">Qualitative Comparisons with SDXL + Dr.Bokeh</h2>
        <!-- Any description here -->
      </div>
    </div>
    <div class="slider-section">
      <div class="slider-container">
        <div class="slider">
          <div class="slide">
            <div class="grid1x1-sdxl">
             <div class="video-with-label">
               <img src="/static/defocus-blur-gen/imgs/results-sdxl-1.png" width="100%" alt="Ours vs SDXL result">
             </div>
            </div>
          </div>
          <div class="slide">
            <div class="grid1x1-sdxl">
             <div class="video-with-label">
               <img src="/static/defocus-blur-gen/imgs/results-sdxl-2.png" width="100%" alt="Ours vs SDXL result">
             </div>
            </div>
          </div>
          <div class="slide">
            <div class="grid1x1-sdxl">
             <div class="video-with-label">
               <img src="/static/defocus-blur-gen/imgs/results-sdxl-3.png" width="100%" alt="Ours vs SDXL result">
             </div>
            </div>
          </div>
        </div>
        <button class="slider-button prev" onclick="moveSlide(-1)">❮</button>
        <button class="slider-button next" onclick="moveSlide(1)">❯</button>
      </div>
      <!-- <p style="text-align: center; ">(Frame transition: 1.5 sec)</p> -->
      <div class="slider-dots"></div>
    </div>
  </div>
</section>



<section class="section">
  <div class="container is-max-desktop">
    <div class="columns is-centered">
      <div class="content">
        <h2 class="title is-4">Qualitative Comparisons with Camera Settings as Tokens</h2>
        <!-- Any description here -->
      </div>
    </div>
    <div class="slider-section">
      <div class="slider-container">
        <div class="slider">
          <div class="slide">
            <div class="grid1x1-csat">
             <div class="video-with-label">
               <img src="/static/defocus-blur-gen/imgs/results-csat-1.png" width="100%" alt="Ours vs SDXL result">
             </div>
            </div>
          </div>
          <div class="slide">
            <div class="grid1x1-csat">
             <div class="video-with-label">
               <img src="/static/defocus-blur-gen/imgs/results-csat-2.png" width="100%" alt="Ours vs SDXL result">
             </div>
            </div>
          </div>
        </div>
        <button class="slider-button prev" onclick="moveSlide(-1)">❮</button>
        <button class="slider-button next" onclick="moveSlide(1)">❯</button>
      </div>
      <!-- <p style="text-align: center; ">(Frame transition: 1.5 sec)</p> -->
      <div class="slider-dots"></div>
    </div>
  </div>
</section>


<section class="section">
  <div class="container is-max-desktop">

    <div class="columns is-centered">
      <div class="content">
        <h2 class="title is-4">Controllability</h2>
        <!-- Any description here -->
      </div>
    </div>
        <div class="content">
          <p>
            By varying the focus distance and the aperture, we show the controllability of defocus blur using our model.
          </p>
          <div class="image is-centered mt-6">
            <video id="control" autoplay muted loop playsinline height="80%">
              <source src="/static/defocus-blur-gen/videos/control.mp4" type="video/mp4">
            </video>
            </div>
        </div>
    </div>  
  </div>
</section>


<section class="section">
  <div class="container is-max-desktop">
    <div class="columns is-centered" style="margin-bottom: 0; padding-bottom: 0;">
      <div class="content" style="margin-bottom: 0; padding-bottom: 0;">
        <h2 class="title is-4">More Examples</h2>
      </div>
    </div>
        <div class="content" style="margin-top: 0; padding-top: 0;">
          <div class="image is-centered mt-6" style="margin-top: 0; padding-top: 0; margin-bottom: 0; padding-bottom: 0;">
            <video id="qual-examples" autoplay muted loop playsinline height="100%">
              <source src="/static/defocus-blur-gen/videos/qual-examples.mp4" type="video/mp4">
            </video>
            </div>
        </div>
    </div>
  </div>
</section>



<section class="section">
  <div class="container is-max-desktop">

    <div class="columns is-centered">
      <div class="content">
        <h2 class="title is-3">Related Work</h2>
        <!-- Any description here -->
      </div>

    </div>
        <div class="content" style="font-size: 0.95em;">
          <p id="csat">[1] <a href="https://camera-settings-as-tokens.github.io/" target="_blank">Camera Settings as Tokens: Modeling Photography on Latent Diffusion Models</a></p>
          <p id="taf">[2] <a href="https://taf.mpi-inf.mpg.de/" target="_blank">An Implicit Neural Representation for the Image Stack: Depth, All in Focus, and High Dynamic Range</a></p>
          <p id="dmd2">[3] <a href="https://tianweiy.github.io/dmd2/" target="_blank">Improved Distribution Matching Distillation for Fast Image Synthesis</a></p>
        </div>
    </div>
    
  </div>
</section>



<section class="section" id="bibtex">
  <div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@InProceedings{shrivastava2025defocusblur,
      title     = {Fine-grained Defocus Blur Control for Generative Image Models},
      author    = {Shrivastava, Ayush and Barnes, Connelly and Zhang, Xuaner and Zhang, Lingzhi and Owens, Andrew and Amirghodsi, Sohrab and Shechtman, Eli},
      booktitle = {arXiv},
      year      = {2025},
}
      <!-- url       = {https://arxiv.org/abs/2506.03148}, -->
</code></pre>
  </div>
</section>


<style>
  .slider-container {
    position: relative;
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
    overflow: hidden;
    height: auto;
    min-height: unset;
    display: flex;
    align-items: center;
    justify-content: center;
    left: 50%;
    transform: translateX(-50%);
    max-height: 1000px;
  }
  
  .slider {
    display: flex;
    transition: transform 0.5s ease-in-out;
    width: 100%;
  }
  
  .slide {
    min-width: 100%;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    width: 100%;
  }
  
  .grid1x1-sdxl {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    gap: 16px;
    width: 100%;
    max-width: 600px;
    height: 100%;
    margin: 0 auto;
  }

  .grid1x1-csat {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    gap: 16px;
    width: 100%;
    max-width: 800px;
    height: 100%;
    margin: 0 auto;
  }
  
  .grid1x1-small {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    gap: 16px;
    width: 100%;
    max-width: 1000px;
    height: 100%;
    margin: 0 auto;
  }
  
  .grid2x2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 16px;
    width: 100%;
    max-width: 1200px;
    height: 100%;
    margin: 0 auto;
  }
  
  .video-with-label {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
  }
  
  .video-with-label video {
    width: 100%;
    height: 100%;
    max-height: 100%;
    object-fit: contain;
    background: #eee;
    display: block;
  }
   .video-with-label img {
     width: 100%;
     height: auto;
     background: #eee;
     display: block;
   }
  
  .video-label {
    width: 100%;
    text-align: center;
    font-size: 1rem;
    color: #222;
    background: rgba(255,255,255,0.85);
    padding: 4px 0 2px 0;
    height: 15%;
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .slider-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    color: white;
    padding: 16px 12px;
    border: none;
    cursor: pointer;
    font-size: 18px;
    transition: background 0.3s;
    z-index: 3;
  }
  
  .slider-button:hover {
    background: rgba(0, 0, 0, 0.8);
  }
  
  .prev { left: 0; }
  .next { right: 0; }
  
  .slider-dots {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 18px 0 0 0;
    gap: 10px;
  }
  .slider-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #bbb;
    opacity: 0.5;
    transition: background 0.3s, opacity 0.3s;
    cursor: pointer;
  }
  .slider-dot.active {
    background: #222;
    opacity: 1;
  }
  
  .grid3x3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 16px;
    width: 100%;
    max-width: 1200px;
    height: 100%;
    margin: 0 auto;
  }
  
  .video-with-label video {
    max-height: 100%;
    width: auto;
    height: 100%;
    object-fit: contain;
  }
  
  .hero.teaser .hero-body {
    margin-bottom: 0.5rem; /* Reduce as needed */
    padding-bottom: 1.5rem; /* Reduce as needed */
  }
  
  .hero.teaser .column.is-gapless {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
  
  .hero.teaser .subtitle {
    margin-top: 0.5rem !important;
  }
  
  .hero.teaser .mt-4 {
    margin-top: 0.5rem !important; /* or 0 if you want no space */
  }
  
  </style>
  
  <script>
  function initSlider(sliderSection) {
    const slider = sliderSection.querySelector('.slider');
    const slides = sliderSection.querySelectorAll('.slide');
    const prevBtn = sliderSection.querySelector('.slider-button.prev');
    const nextBtn = sliderSection.querySelector('.slider-button.next');
    const dotsContainer = sliderSection.querySelector('.slider-dots');
    let currentSlide = 0;
    const totalSlides = slides.length;
  
    // Set slider and slide widths
    slider.style.width = `${totalSlides * 100}%`;
    slides.forEach(slide => {
      slide.style.width = `${100 / totalSlides}%`;
    });
  
    // Create dots
    dotsContainer.innerHTML = '';
    for (let i = 0; i < totalSlides; i++) {
      const dot = document.createElement('div');
      dot.className = 'slider-dot' + (i === 0 ? ' active' : '');
      dot.addEventListener('click', () => {
        currentSlide = i;
        updateSlider();
      });
      dotsContainer.appendChild(dot);
    }
  
    function updateSlider() {
      slider.style.transform = `translateX(-${currentSlide * 100}%)`;
      const dots = dotsContainer.querySelectorAll('.slider-dot');
      dots.forEach((dot, idx) => {
        dot.classList.toggle('active', idx === currentSlide);
      });
    }
  
    prevBtn.addEventListener('click', () => {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateSlider();
    });
  
    nextBtn.addEventListener('click', () => {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateSlider();
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.slider-section').forEach(initSlider);
  });
  </script>


<footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>,
            and is written by <a href="https://keunhong.com/">Keunhong Park</a> for the <a href="https://github.com/nerfies/nerfies.github.io">Nerfies</a> project. You are free to use the <a href="https://github.com/nerfies/nerfies.github.io">source code</a> of this website, but please keep these links in the footer.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
